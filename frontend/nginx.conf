# This is the Nginx rulebook.

server {
  # Nginx will listen for requests on port 80 inside the container.
  listen 80;

  # Rule #1: Handle API requests
  location /api {
    # If a request starts with /api, pass it to the backend service.
    # The name 'backend' comes from our docker-compose.yml service name.
    # The port '8000' is where our FastAPI app is running inside its container.
    proxy_pass http://backend:8000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }

  # Rule #2: Handle all other requests (i.e., serve the React app)
  location / {
    # Look for files in this directory inside the container.
    root   /usr/share/nginx/html;
    index  index.html;
    # This is important for single-page apps like React.
    # If a direct URL doesn't match a file, serve index.html and let React handle the routing.
    try_files $uri /index.html;
  }
}